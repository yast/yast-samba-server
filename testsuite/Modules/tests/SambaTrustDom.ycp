{
    //testedfiles: SambaTrustDom.pm

    include "testsuite.ycp";

    map READ = $[];
    map WRITE = $[];
    map EXEC = $[];

    map EXEC1 = $[
	"target" : $["bash" : 0],
    ];

    map EXEC2 = $[
	"target" : $["bash" : 1],
    ];

    TESTSUITE_INIT ([READ, WRITE, EXEC], nil);

    import "SambaTrustDom";

    DUMP ("------------------------------------------------------------");
    TEST (``(SambaTrustDom::Establish("domain", "password")), [READ, WRITE, EXEC1], nil);
    TEST (``(SambaTrustDom::Establish("domain", "password")), [READ, WRITE, EXEC2], nil);
    DUMP ("------------------------------------------------------------");
    TEST (``(SambaTrustDom::Establish("domain", "password\"\"abc")), [READ, WRITE, EXEC1], nil);
    TEST (``(SambaTrustDom::Establish("domain", "password\"\"abc")), [READ, WRITE, EXEC2], nil);
    DUMP ("------------------------------------------------------------");
    TEST (``(SambaTrustDom::Establish("domain", "pas''sword\"\"'\"abc")), [READ, WRITE, EXEC1], nil);
    TEST (``(SambaTrustDom::Establish("domain", "pas''sword\"\"'\"abc")), [READ, WRITE, EXEC2], nil);
    DUMP ("------------------------------------------------------------");
}
